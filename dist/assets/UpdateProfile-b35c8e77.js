import{c as C,b as E,r as o,aq as B,ar as Y,D as z,j as e}from"./index-5d1582d4.js";import{n as A}from"./index-d5b70956.js";import{d as c,c as R,D as W}from"./index-81ffed24.js";import{N as l}from"./Notification-b903467d.js";import{F as a}from"./index-2daf2b68.js";import{S as G}from"./index-8ccb2d3a.js";import{U as H}from"./index-1567c69b.js";import{I as m}from"./index-ef77481e.js";import{S as d}from"./index-a21a4ee5.js";import{B as Q}from"./button-1dd3c86b.js";import{L as v}from"./compact-item-f6aa6deb.js";import{P as V}from"./PlusOutlined-c3648a15.js";import"./iconBase-7dfc76c2.js";import"./PurePanel-9c90c19c.js";import"./useMergedState-a94f801d.js";import"./Compact-de17ca2f.js";import"./ResizeObserver.es-f4289e8a.js";import"./pickAttrs-c42834d1.js";import"./index-8ab4410e.js";import"./Overflow-dad1924c.js";import"./useZIndex-412122f7.js";import"./SearchOutlined-54091923.js";import"./asyncToGenerator-f41fc0b7.js";import"./useCSSVarCls-2b45069f.js";import"./index-c0762df4.js";import"./move-8c08fc05.js";import"./index-98be3a7d.js";import"./reactNode-ed0d3403.js";import"./useLocale-98ce2b95.js";import"./render-43f47cb9.js";import"./ExclamationCircleFilled-3566f72d.js";import"./CloseOutlined-21301cb3.js";import"./collapse-97de76d4.js";import"./row-140c9d21.js";import"./responsiveObserver-74647030.js";import"./fade-72ecde73.js";import"./useForceUpdate-3f4a0339.js";import"./CheckOutlined-9e439339.js";import"./BaseInput-5f67969b.js";import"./index-3f290c1a.js";import"./DownOutlined-e8684ab4.js";const Me=()=>{c.extend(R);const[h]=a.useForm(),{id:g}=C(),u=E(),[p,x]=o.useState(null),[b,L]=o.useState(null),[j,y]=o.useState(!1),{data:t,isLoading:S}=B(g||""),[w,{isLoading:F}]=Y(),[q,{isLoading:P}]=z();o.useEffect(()=>{var s,n,r,i,f,I,N,T,U,k;h.setFieldsValue({job:(s=t==null?void 0:t.data)==null?void 0:s.job,fullName:(n=t==null?void 0:t.data)==null?void 0:n.fullName,gender:(r=t==null?void 0:t.data)==null?void 0:r.gender,email:(i=t==null?void 0:t.data)==null?void 0:i.email,address:(f=t==null?void 0:t.data)==null?void 0:f.address,birthdate:(I=t==null?void 0:t.data)!=null&&I.birthdate?c((N=t==null?void 0:t.data)==null?void 0:N.birthdate):void 0,phoneNumber:(T=t==null?void 0:t.data)==null?void 0:T.phoneNumber}),(U=t==null?void 0:t.data)!=null&&U.imgUrl&&x((k=t==null?void 0:t.data)==null?void 0:k.imgUrl)},[t,h]);const O=async s=>{L(s),y(!0),setTimeout(()=>{const n=URL.createObjectURL(s);x(n),y(!1)},2e3)},M=async s=>{delete s.imageObjectId,s.id=g,s.status=1,s.birthdate=c(s.birthdate).format("YYYY-MM-DD"),w(s).unwrap().then(n=>{const r=n==null?void 0:n.data,i=new FormData;if(b)i.append("image",b);else{l("success","Thành công","Tạo hồ sơ khám bệnh thành công"),u("/ho-so-kham-benh");return}r&&i.append("id",r),q(i).unwrap().then(()=>{l("success","Thành công","Tạo hồ sơ khám bệnh thành công"),u("/ho-so-kham-benh")})}).catch(n=>{l("warning","Cảnh báo",n.data.message||n.data)})};return e.jsxs("div",{children:[e.jsx("h1",{className:"font-medium text-gray-800 text-xl mb-8",children:"Tạo hồ sơ bệnh nhân"}),e.jsx(G,{spinning:S,children:e.jsxs(a,{form:h,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:700},initialValues:{remember:!0},labelWrap:!0,autoComplete:"off",className:"ml-20",onFinish:M,children:[e.jsxs("div",{className:"max-h-[450px] overflow-y-auto pr-8 mb-8 ",style:{scrollbarWidth:"thin"},children:[e.jsx(a.Item,{label:"Ảnh",name:"imageObjectId",children:e.jsx(H,{beforeUpload:s=>{const n="2";s.size/1024/1024<n?O(s):l("warning","Cảnh báo","Ảnh không được quá "+n.toString()+"MB")},showUploadList:!1,listType:"picture-circle",accept:"image/*",children:p?j?e.jsxs("div",{children:[e.jsx(v,{}),e.jsx("div",{style:{marginTop:8},children:"Đang tải ảnh..."})]}):e.jsx("img",{src:p,alt:"Ảnh đã upload",className:"max-h-[100px] max-w-[100px] rounded-full aspect-square object-cover"}):e.jsx("div",{children:j?e.jsxs("div",{children:[e.jsx(v,{}),e.jsx("div",{style:{marginTop:8},children:"Đang tải ảnh..."})]}):e.jsxs("div",{children:[e.jsx(V,{}),e.jsx("div",{style:{marginTop:8},children:"Upload"})]})})})}),e.jsx(a.Item,{label:"Họ và tên",name:"fullName",rules:[{required:!0,message:"Trường này không được bỏ trống !"},{min:6,message:"Họ tên phải trên 6 kí tự"}],children:e.jsx(m,{})}),e.jsx(a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Trường này không được bỏ trống !"},{type:"email",message:"Email không đúng định dạng"}],children:e.jsx(m,{})}),e.jsx(a.Item,{label:"Số điện thoại",name:"phoneNumber",rules:[{required:!0,message:"Trường này không được bỏ trống !"},{pattern:/^(0[0-9]{9,10})$/,message:"Số điện thoại không đúng định dạng"}],children:e.jsx(m,{})}),e.jsx(a.Item,{label:"Giới tính",name:"gender",rules:[{required:!0,message:"Trường này không được bỏ trống !"}],children:e.jsxs(d,{children:[e.jsx(d.Option,{value:2,children:"Khác"}),e.jsx(d.Option,{value:1,children:"Nam"}),e.jsx(d.Option,{value:0,children:"Nữ"})]})}),e.jsx(a.Item,{label:"Ngày sinh",name:"birthdate",rules:[{required:!0,message:"Trường này không được bỏ trống !"}],children:e.jsx(W,{showTime:!1,className:"w-full"})}),e.jsx(a.Item,{label:"Địa chỉ",name:"address",rules:[{required:!0,message:"Trường này không được bỏ trống !"}],children:e.jsx(m,{})}),e.jsx(a.Item,{label:"Công việc",name:"job",rules:[{required:!0,message:"Trường này không được bỏ trống !"}],children:e.jsx(m,{})})]}),e.jsx(a.Item,{labelAlign:"left",children:e.jsx(Q,{type:"primary",htmlType:"submit",className:"bg-blue-500",children:P||F?e.jsx(A,{className:"animate-spin"}):"Cập nhật hồ sơ"})})]})})]})};export{Me as default};
